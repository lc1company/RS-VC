<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <title>Dashboard</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .tabs {
            display: flex;
            white-space: nowrap;
            overflow-x: auto;
            justify-content: space-between;
            border-bottom: 1px solid #ccc;
            margin-bottom: 20px;
            background-color: #0056b3;
            color: #fff;
            border-radius: 5px;
            width: 100%;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .timeline {
            list-style: none;
            padding: 0;
        }

        .timeline-item {
            position: relative;
            border-bottom: 1px solid #ccc;
            padding: 10px 0;
        }

        .timeline-item:last-child {
            border-bottom: none;
        }

        #formPublicacao {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: nowrap;
        }

        #inputMensagem {
            flex: 1;
            padding: 10px;
            font-size: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-left: auto;
            margin-right: auto;
        }

        #inputImagem {
            display: none;
        }

        #btnEscolherArquivo {
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-left: 2%;
            margin-right: 2%;
        }

        #btnEscolherArquivo:hover {
            background-color: #0056b3;
        }

        #formPublicacao input[type="file"] {
            margin-bottom: 10px;
        }

        .publicacao-img {
            max-width: 95%;
            max-height: 40%;
            object-fit: cover;
        }

        #btnEscolherFotoPerfil {
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
            margin-bottom: 10px;
            margin-left: auto;
            margin-right: auto;
        }

        #btnEscolherFotoPerfil:hover {
            background-color: #0056b3;
        }

        #userProfilePicture {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin-left: auto;
            margin-right: auto;
            object-fit: cover;
        }

        /* Estilos para os botões de like, dislike e comentários */
        .timeline-item button {
            background-color: #007bff;
            color: #fff;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
            margin-bottom: 2%;
            margin-top: 2%;
            transition: background-color 0.3s ease;
        }

        .timeline-item button:hover {
            background-color: #0056b3;
        }

        /* Estilos para o contêiner de comentários */
        .comments-container {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            width: 100%;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .comments-container p {
            margin-bottom: 5px;
        }

        .comments-container textarea {
            width: calc(100% - 20px);
            height: 100px;
            padding: 5px;
            margin-top: 5px;
            border-radius: 4px;
            resize: none;
        }

        .comments-container button {
            background-color: #007bff;
            color: #fff;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .comments-container button:hover {
            background-color: #0056b3;
        }

        footer {
            background-color: rgb(255, 255, 255);
            color: rgb(0, 0, 0);
            text-align: center;
            padding: 1em 0;
            position: relative;
            bottom: 0;
            width: auto;
            min-width: 100%;
        }

        .user-profile-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            /* Fundo semi-transparente para sobreposição */
            justify-content: center;
            /* Alinhamento central verticalmente */
            align-items: center;
            /* Alinhamento central horizontalmente */
        }

        .user-profile-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
            width: 75%;
            text-align: center;
        }

        #formPublicacao {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #formPublicacao h2 {
            width: 100%;
            text-align: center;
            margin-bottom: 20px;
        }

        #formPublicacao input[type="text"],
        #formPublicacao input[type="number"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            margin-bottom: 10px;
        }

        #formPublicacao input[type="file"] {
            display: none;
        }

        #formPublicacao button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 12px 20px;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        #formPublicacao button:hover {
            background-color: #0056b3;
        }

        .notification-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .notification-item img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .notification-item .user-info {
            display: flex;
            flex-direction: column;
        }

        .notification-item .user-info span {
            font-weight: bold;
        }

        .notification-item .notification-text {
            margin-left: 10px;
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="tabs">
            <div class="tab" onclick="showTab('timeline')"><i class="fas fa-stream"></i>Linha do Tempo</div>
            <div class="tab" onclick="showTab('Produtor')"><i class="fas fa-calendar-plus"></i>Produzir Evento</div>
            <div class="tab" onclick="showTab('meuPerfil')"><i class="fas fa-user"></i>Meu Perfil</div>
            <div class="tab" onclick="showTab('notificacoes')"><i class="fas fa-bell"></i>Notificações</div>
            <div class="tab" onclick="showTab('userInfo')"><i class="fas fa-cog"></i>Configurações</div>
        </div>

        <div id="userInfo" class="tab-content">
            <h2>Informações do Usuário</h2>
            <p id="userFullName"></p>
            <p id="userEmail"></p>
            <h2>Sair</h2>
            <button style="background-color: rgb(255, 0, 0); color: #fff; font-size: 17px; border-radius: 5px;"
                onclick="signOut()">Sair</button>
        </div>

        <div id="timeline" class="tab-content active">
            <h2>Linha do Tempo</h2>
            <button onclick="capturarLocalizacao()">Encontrar Evento na cidade</button>
            <ul class="timeline" id="userTimeline">
                <!-- Timeline items will be dynamically added here -->
            </ul>
        </div>

        <div id="notificacoes" class="tab-content">
            <h2>Notificações</h2>
            <ul id="notificationsList" class="notifications-list"></ul>
        </div>

        <div id="meuPerfil" class="tab-content">
            <h2>Meu Perfil</h2>
            <div>
                <img id="userProfilePicture" src="" alt="Foto de Perfil" loading="lazy">
                <p id="FullName"></p>
                <input type="file" accept="image/*" id="inputFotoPerfil" onchange="handleProfilePictureUpload(event)"
                    style="display: none;">
                <button type="button" id="btnEscolherFotoPerfil" class="upload-button">Escolher Foto de Perfil</button>
            </div>
        </div>

        <div id="userProfileContainer" class="user-profile-container" style="display: none;">
            <div class="user-profile-content">
                <button
                    style="background-color: red; color: #fff; font-size: 15px; position: absolute; top: 10; left: 0; margin-left: 12%; right: 1; cursor: pointer"
                    onclick="closeUserProfile()">X</button>
                <img id="userProfilePicturePopUp" alt="Foto do usuário"
                    style="width: 25%; height: 20%; border-radius: 50%; object-fit: cover;" loading="lazy">
                <p id="userProfileName"></p>
            </div>
        </div>

        <div id="Produtor" class="tab-content">
            <h2>Área do Produtor</h2>
            <form id="formPublicacao" style="display: none;">
                <button type="button" id="btnEscolherArquivo">Upload Imagem</button>
                <input type="file" accept="image/*" id="inputImagem" style="display: none;" required>
                <input type="text" maxlength="200" placeholder="Nome do Produto" id="inputMensagem" required>
                <input type="text" maxlength="200" placeholder="Descrição do Produto" id="inputDescricao" required>
                <input type="number" placeholder="Preço do Produto" id="inputPreco" step="0.01" required>
                <select id="inputCidadeEvento" required>
                    <option value="">Selecione a cidade do evento</option>
                    <option value="limeira">Limeira</option>
                    <option value="americana">Americana</option>
                    <option value="piracicaba">Piracicaba</option>
                    <!-- Adicione outras cidades conforme necessário -->
                </select><br><br>
                <button
                    style="margin-right: 2%; margin-left: 2%; font-size: 16px; background-color: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer;"
                    type="submit">Publicar</button>
            </form>

            <div id="avisoNaoProdutor" style="display: none;">
                <p>Você não é um Produtor parceiro.</p>
                <p><a href="link_para_formulario_de_cadastro" target="_blank">Cadastre-se como um produtor de eventos
                        parceiro</a>
                </p>
            </div>

            <!--Preview do Anúncio-->
            <div id="previewContainer"
                style="display: none; background-color: #f0f0f0; padding: 10px; border-radius: 8px; margin-top: 20px; text-align: center;">
                <p>Pré-visualização do anúncio:</p>
                <p id="mensagemPreview" style="margin-top: 10px; font-style: italic;"></p>
                <p id="descricaoPreview" style="margin-top: 10px; font-style: italic;"></p>
                <p id="precoPreview" style="margin-top: 10px; font-weight: bold;"></p>
                <div style="display: flex; justify-content: center;">
                    <img id="imgPreview" src="#" alt="Preview da Imagem" style="max-width: 300px; max-height: 300px;">
                </div>
            </div>
        </div>

    </div>

    <footer>
        <p>&copy; 2024 LC Company</p>
        <a href="PoliticaPrivacidade.html" target="_blank" style="color: rgb(0, 0, 0); margin-right: 4%;">Política de
            Privacidade</a>
        <a href="TermosDeUso.html" target="_blank" style="color: rgb(0, 0, 0);">Termos de Uso</a>
    </footer>

    <!--bibliotecas do Firebase -->
    <script type="module">
        // Importar as bibliotecas do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, collection, addDoc, getDocs, deleteDoc, serverTimestamp, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";
        import { updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { deleteObject } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        // Configurações do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyATKjtf2xqjdVtZFHSdrZOcA0Taa3J4gao",
            authDomain: "redesocialmarktplace.firebaseapp.com",
            projectId: "redesocialmarktplace",
            storageBucket: "redesocialmarktplace.appspot.com",
            messagingSenderId: "389449887892",
            appId: "1:389449887892:web:e87a07a73c04b2ad9d8481",
            measurementId: "G-KQ8Q4LZVB1"
        };

        // Inicializar o Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Verificar se o usuário está autenticado
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Se estiver autenticado, obter informações do usuário
                getUserInfo(user.uid);
                getUserTimeline(user.uid);
                getAllUserTimeline();
                exibirPerfilUsuario(user.uid);
                checkUserRole();
                const currentUserId = auth.currentUser.uid;
                getUserNotifications(currentUserId);
            } else {
                window.location.href = "login.html"
                console.log("Usuário não autenticado.");
            }
        });

        // Função para obter informações do usuário
        async function getUserInfo(uid) {
            const userDoc = await getDocs(collection(db, "users"));
            userDoc.forEach((doc) => {
                if (doc.id === uid) {
                    const userData = doc.data();
                    document.getElementById("userFullName").textContent = `Nome: ${userData.fullName}`;
                    document.getElementById("userEmail").textContent = `Email: ${userData.email}`;
                }
            });
        }

        window.capturarLocalizacao = function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async function (position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;

                    // Chama a função para converter as coordenadas em nome da cidade
                    const cidade = await converterCoordenadasParaCidade(latitude, longitude);

                    // Aqui você pode usar o nome da cidade para qualquer ação necessária
                    console.log(`Localização capturada: Latitude ${latitude}, Longitude ${longitude}, Cidade: ${cidade}`);

                    // Por exemplo, você pode enviar esses dados para o servidor ou fazer outra operação
                }, function (error) {
                    console.error('Erro ao capturar localização:', error);
                });
            } else {
                console.error('Geolocalização não suportada pelo navegador.');
            }
        }

        async function converterCoordenadasParaCidade(latitude, longitude) {
            try {
                // Faz uma requisição para o serviço de geocodificação reversa (Nominatim)
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`);
                const data = await response.json();

                // Verifica se a requisição foi bem-sucedida e retorna o nome da cidade
                if (data && data.address && data.address.city) {
                    return data.address.city;
                } else {
                    console.error('Não foi possível obter o nome da cidade a partir das coordenadas.');
                    return null;
                }
            } catch (error) {
                console.error('Erro ao converter coordenadas para cidade:', error);
                return null;
            }
        }

        // Função para obter a timeline do usuário
        async function getUserTimeline(uid) {
            const publicacoesRef = collection(db, "publicacoes");
            const querySnapshot = await getDocs(publicacoesRef);
            if (!querySnapshot.empty) {
                const userTimeline = document.getElementById("userTimeline");
                userTimeline.innerHTML = ""; // Limpar a timeline antes de adicionar novos itens
                querySnapshot.forEach((doc) => {
                    const publicacaoData = doc.data();
                    if (publicacaoData.userId === uid) {
                        const li = document.createElement("li");
                        li.classList.add("timeline-item");
                        li.innerHTML = `
                        <p>${publicacaoData.mensagem}</p>
                        <img src="${publicacaoData.imagemUrl}" class="publicacao-img" alt="Publicação" loading="lazy">
                        <p>Data e Hora: ${publicacaoData.timestamp}</p>`;
                        userTimeline.appendChild(li);
                    }
                });
            } else {
                console.log("Nenhuma publicação encontrada.");
            }
        }

        // Função para publicar uma nova publicação
        document.getElementById("formPublicacao").addEventListener("submit", async (e) => {
            e.preventDefault();

            const mensagem = document.getElementById("inputMensagem").value;
            const descricao = document.getElementById("inputDescricao").value;
            const preco = document.getElementById("inputPreco").value;
            const imagem = document.getElementById("inputImagem").files[0];
            const cidadeEvento = document.getElementById("inputCidadeEvento").value;

            if (!imagem) {
                alert("Por favor, selecione uma imagem.");
                return;
            }

            const compressedBlob = await compressImage(imagem);
            const storageRef = ref(storage, `imagens/${imagem.name}`);
            const snapshot = await uploadBytes(storageRef, compressedBlob);
            const imagemUrl = await getDownloadURL(snapshot.ref);

            await addDoc(collection(db, "publicacoes"), {
                mensagem: mensagem,
                descricao: descricao,
                preco: preco,
                imagemUrl: imagemUrl,
                timestamp: serverTimestamp(),
                userId: auth.currentUser.uid,
                cidadeEvento: cidadeEvento // Incluir a cidade do evento na publicação
            });

            getUserTimeline(auth.currentUser.uid);

            document.getElementById("inputMensagem").value = "";
            document.getElementById("inputDescricao").value = "";
            document.getElementById("inputPreco").value = "";
            document.getElementById("inputImagem").value = "";
            document.getElementById("inputCidadeEvento").value = ""; // Limpar o campo da cidade do evento

            location.reload(); // Recarregar a página para atualizar a linha do tempo
        });

        // Função para verificar o papel do usuário
        async function checkUserRole() {
            const user = auth.currentUser;
            if (!user) {
                console.log("Usuário não autenticado.");
                return;
            }

            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                if (userData.role === "Produtor") {
                    document.getElementById("formPublicacao").style.display = "block";
                } else {
                    console.log("Usuário não é um Produtor.");
                    document.getElementById("avisoNaoProdutor").style.display = "block";
                }
            } else {
                console.log("Documento do usuário não encontrado.");
            }
        }

        // Chame a função para verificar o papel do usuário ao carregar a página
        window.onload = checkUserRole;

        // Função para comprimir a imagem
        window.compressImage = async function (imageFile) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = function (event) {
                    const img = new Image();

                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Definir as dimensões máximas da imagem
                        const maxWidth = 800;
                        const maxHeight = 600;

                        let width = img.width;
                        let height = img.height;

                        // Redimensionar a imagem mantendo a proporção
                        if (width > height) {
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width *= maxHeight / height;
                                height = maxHeight;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;

                        // Desenhar a imagem redimensionada no canvas
                        ctx.drawImage(img, 0, 0, width, height);

                        // Converter o canvas de volta para Blob
                        canvas.toBlob((blob) => {
                            resolve(blob);
                        }, 'image/jpeg', 0.8); // Comprimir para JPEG com 80% de qualidade
                    };

                    img.src = event.target.result;
                };

                reader.readAsDataURL(imageFile);
            });
        }

        // Função para alternar entre as abas
        window.showTab = function (tabId) {
            const tabs = document.querySelectorAll(".tab-content");
            tabs.forEach(tab => {
                tab.classList.remove("active");
            });
            const selectedTab = document.getElementById(tabId);
            selectedTab.classList.add("active");
        }

        // Função para obter a linha do tempo de todos os usuários
        window.getAllUserTimeline = async function () {
            try {
                const publicacoesRef = collection(db, "publicacoes");
                const querySnapshot = await getDocs(query(publicacoesRef, orderBy("timestamp", "desc")));
                const userTimeline = document.getElementById("userTimeline");
                userTimeline.innerHTML = ""; // Limpar a linha do tempo antes de adicionar novos itens

                querySnapshot.forEach(async (doc) => {
                    const data = doc.data();
                    console.log("Publicações exibidas com sucesso");
                    const timestamp = data.timestamp.toDate();
                    const dia = String(timestamp.getDate()).padStart(2, '0');
                    const mes = String(timestamp.getMonth() + 1).padStart(2, '0');
                    const ano = timestamp.getFullYear();
                    const horas = String(timestamp.getHours()).padStart(2, '0');
                    const minutos = String(timestamp.getMinutes()).padStart(2, '0');
                    const dataFormatada = `${dia}/${mes}/${ano} ${horas}:${minutos}`;

                    const user = await getUserData(data.userId);

                    // Criação do elemento li para cada publicação
                    const li = document.createElement("li");
                    li.classList.add("timeline-item");
                    li.style.backgroundColor = "#f0f0f0";
                    li.style.padding = "10px";
                    li.style.borderRadius = "4px";
                    li.style.marginBottom = "15%";
                    li.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.1)"; // Estilo 3D padrão
                    li.style.transition = "all 0.3s ease"; // Transição suave
                    li.style.transform = "translateY(0)"; // Posição padrão

                    // Função para aplicar o estilo de hover/touch
                    function applyHoverStyles() {
                        li.style.boxShadow = "0 20px 40px rgba(0, 0, 0, 0.5)"; // Sombra mais forte
                        li.style.transform = "translateY(-10px)"; // Levanta o item mais
                    }

                    // Função para remover o estilo de hover/touch
                    function removeHoverStyles() {
                        li.style.boxShadow = "0 10px 20px rgba(0, 0, 0, 0.3)"; // Sombra padrão
                        li.style.transform = "translateY(0)"; // Volta à posição original
                    }

                    // Adiciona os eventos de mouse e toque
                    li.addEventListener("mouseover", applyHoverStyles);
                    li.addEventListener("mouseout", removeHoverStyles);
                    li.addEventListener("touchstart", applyHoverStyles, { passive: true }); // Para dispositivos móveis
                    li.addEventListener("touchend", removeHoverStyles, { passive: true }); // Para dispositivos móveis

                    // Criar um contêiner para a foto do usuário e o nome do usuário
                    const userInfoContainer = document.createElement("div");
                    userInfoContainer.style.display = "flex";
                    userInfoContainer.style.alignItems = "center";
                    userInfoContainer.style.marginBottom = "10px";

                    // Adicionar a foto do usuário ao contêiner
                    const userImg = document.createElement("img");
                    userImg.src = user.photoURL;
                    userImg.alt = "Foto do usuário";
                    userImg.style.width = "60px";
                    userImg.style.height = "60px";
                    userImg.style.borderRadius = "50%";
                    userImg.style.marginRight = "15px";
                    userImg.style.cursor = "pointer";
                    userImg.style.border = "2px solid #ddd"; // Borda sutil
                    userImg.onclick = () => showUserProfile(user.userId); // Abrir o perfil do usuário ao clicar na foto
                    userInfoContainer.appendChild(userImg);

                    // Adicionar o nome do usuário ao contêiner
                    const userName = document.createElement("p");
                    userName.textContent = user.fullName;
                    userName.style.fontWeight = "bold";
                    userName.style.cursor = "pointer";
                    userName.onclick = () => showUserProfile(user.userId); // Abrir o perfil do usuário ao clicar no nome
                    userInfoContainer.appendChild(userName);

                    // Adicionar o contêiner de informações do usuário ao li
                    li.appendChild(userInfoContainer);

                    // Adicionar a mensagem da publicação
                    const mensagem = document.createElement("p");
                    mensagem.textContent = data.mensagem;
                    mensagem.style.marginBottom = "10px";
                    mensagem.style.fontSize = "16px";
                    li.appendChild(mensagem);

                    // Adicionar a descrição do produto
                    const descricao = document.createElement("p");
                    descricao.textContent = `Descrição: ${data.descricao}`;
                    descricao.style.fontSize = "14px";
                    descricao.style.color = "#666";
                    li.appendChild(descricao);

                    // Adicionar o preço do produto
                    const preco = document.createElement("p");
                    preco.textContent = `Preço: R$ ${data.preco}`;
                    preco.style.fontSize = "16px";
                    preco.style.fontWeight = "bold";
                    preco.style.color = "#333";
                    li.appendChild(preco);

                    // Adicionar data e hora da publicação
                    const dataHora = document.createElement("p");
                    dataHora.textContent = `Data e Hora: ${dataFormatada}`;
                    dataHora.style.fontSize = "12px";
                    dataHora.style.color = "#999";
                    li.appendChild(dataHora);

                    // Adicionar a imagem da publicação, se existir
                    if (data.imagemUrl) {
                        const imagem = document.createElement("img");
                        imagem.src = data.imagemUrl;
                        imagem.alt = "Imagem da publicação";
                        imagem.style.width = "100%";
                        imagem.style.height = "auto";
                        imagem.style.borderRadius = "4px";
                        imagem.style.marginTop = "10px";
                        li.appendChild(imagem);
                    }

                    // Adicionar botão de excluir publicação (se for o próprio usuário)
                    if (auth.currentUser && auth.currentUser.uid === data.userId) {
                        const deleteButton = document.createElement("button");
                        deleteButton.innerHTML = '<i class="fa fa-trash"></i>';
                        deleteButton.style.backgroundColor = "#e74c3c";
                        deleteButton.style.border = "none";
                        deleteButton.style.color = "#fff";
                        deleteButton.style.padding = "8px 12px";
                        deleteButton.style.borderRadius = "4px";
                        deleteButton.style.cursor = "pointer";
                        deleteButton.style.fontSize = "14px";
                        deleteButton.style.position = "absolute";
                        deleteButton.style.top = "10px";
                        deleteButton.style.right = "10px";
                        deleteButton.onclick = () => deletePost(doc.id, data.userId);
                        li.appendChild(deleteButton);
                    }

                    // Adicionar botão de like
                    const likeButton = document.createElement("button");
                    likeButton.innerHTML = '<i class="fa fa-thumbs-up"></i>';
                    likeButton.style.backgroundColor = "#3498db";
                    likeButton.style.border = "none";
                    likeButton.style.color = "#fff";
                    likeButton.style.padding = "8px 12px";
                    likeButton.style.borderRadius = "4px";
                    likeButton.style.cursor = "pointer";
                    likeButton.style.fontSize = "14px";
                    likeButton.style.marginRight = "10px";
                    likeButton.id = `likeButton_${doc.id}`;
                    likeButton.onclick = () => likePost(doc.id);
                    li.appendChild(likeButton);

                    // Exibir contador de likes
                    const likeCount = document.createElement("span");
                    likeCount.textContent = data.likes || 0;
                    likeCount.style.fontSize = "14px";
                    likeCount.style.color = "#333";
                    likeCount.id = `likeCount_${doc.id}`;
                    li.appendChild(likeCount);

                    // Adicionar botão de dislike
                    const dislikeButton = document.createElement("button");
                    dislikeButton.innerHTML = '<i class="fa fa-thumbs-down"></i>';
                    dislikeButton.style.backgroundColor = "#e67e22";
                    dislikeButton.style.border = "none";
                    dislikeButton.style.color = "#fff";
                    dislikeButton.style.padding = "8px 12px";
                    dislikeButton.style.borderRadius = "4px";
                    dislikeButton.style.cursor = "pointer";
                    dislikeButton.style.fontSize = "14px";
                    dislikeButton.id = `dislikeButton_${doc.id}`;
                    dislikeButton.onclick = () => dislikePost(doc.id);
                    li.appendChild(dislikeButton);

                    // Exibir contador de dislikes
                    const dislikeCount = document.createElement("span");
                    dislikeCount.textContent = data.dislikes || 0;
                    dislikeCount.style.fontSize = "14px";
                    dislikeCount.style.color = "#333";
                    dislikeCount.id = `dislikeCount_${doc.id}`;
                    li.appendChild(dislikeCount);

                    // Adicionar botão de mostrar comentários
                    const showCommentsButton = document.createElement("button");
                    showCommentsButton.innerHTML = '<i class="fa fa-comments"></i>';
                    showCommentsButton.style.backgroundColor = "#2ecc71";
                    showCommentsButton.style.border = "none";
                    showCommentsButton.style.color = "#fff";
                    showCommentsButton.style.padding = "8px 12px";
                    showCommentsButton.style.borderRadius = "4px";
                    showCommentsButton.style.cursor = "pointer";
                    showCommentsButton.style.fontSize = "14px";
                    showCommentsButton.style.marginLeft = "10px";
                    showCommentsButton.onclick = () => showComments(doc.id);
                    li.appendChild(showCommentsButton);

                    // Exibir contador de comentários
                    const commentCount = document.createElement("span");
                    commentCount.textContent = data.comments || 0;
                    commentCount.style.fontSize = "14px";
                    commentCount.style.color = "#333";
                    commentCount.id = `commentCount_${doc.id}`;
                    li.appendChild(commentCount);

                    // Div para exibir os comentários
                    const commentsDiv = document.createElement("div");
                    commentsDiv.id = `comments_${doc.id}`;
                    commentsDiv.style.display = "none";
                    li.appendChild(commentsDiv);

                    // Textarea para adicionar comentário
                    const commentText = document.createElement("textarea");
                    commentText.id = `commentText_${doc.id}`;
                    commentText.placeholder = "Digite seu comentário";
                    commentText.style.resize = "none";
                    commentText.style.width = "calc(80% - 20px)";
                    commentText.style.height = "20%";
                    li.appendChild(commentText);

                    // Botão para adicionar comentário
                    const addCommentButton = document.createElement("button");
                    addCommentButton.textContent = "Adicionar Comentário";
                    addCommentButton.style.display = "block";
                    addCommentButton.style.marginTop = "2%";
                    addCommentButton.onclick = () => addComment(doc.id);
                    li.appendChild(addCommentButton);

                    // Adicionar o li à linha do tempo do usuário
                    userTimeline.appendChild(li);

                    // Exibir o contador de comentários
                    const comentariosRef = collection(db, `publicacoes/${doc.id}/comentarios`);
                    const comentariosSnapshot = await getDocs(comentariosRef);
                    commentCount.textContent = comentariosSnapshot.size; // Atualiza o total de comentários

                    // Adicionar botão de denúncia
                    const reportButton = document.createElement("button");
                    reportButton.innerHTML = '<i class="fa fa-exclamation-triangle"></i>';
                    reportButton.innerHTML = '<i class="fa fa-flag"></i>';
                    reportButton.style.backgroundColor = "#e74c3c";
                    reportButton.style.border = "none";
                    reportButton.style.color = "#fff";
                    reportButton.style.padding = "8px 12px";
                    reportButton.style.borderRadius = "4px";
                    reportButton.style.cursor = "pointer";
                    reportButton.style.fontSize = "14px";
                    reportButton.style.position = "absolute";
                    reportButton.style.bottom = "10px";
                    reportButton.style.right = "10px";
                    reportButton.id = `reportButton_${doc.id}`;
                    reportButton.onclick = () => reportPost(doc.id);
                    li.appendChild(reportButton);

                    // Adiciona um evento de clique para exibir o perfil do usuário ao clicar na foto ou no nome
                    userImg.onclick = () => showUserProfile(data.userId);
                    userName.onclick = () => showUserProfile(data.userId);
                });
            } catch (error) {
                console.error("Erro ao obter a linha do tempo:", error);
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            showTab('timeline');
        });

        document.getElementById('btnEscolherArquivo').addEventListener('click', function () {
            document.getElementById('inputImagem').click();
        });

        // Função para lidar com o upload da foto de perfil
        function handleProfilePictureUpload(event) {
            const file = event.target.files[0];
            if (file) {
                compressAndUploadProfilePicture(file);
            }
        }

        // Função para comprimir e enviar a foto de perfil para o armazenamento
        window.compressAndUploadProfilePicture = async function (file) {
            try {
                const compressedBlob = await compressImage(file);
                const storageRef = ref(storage, `perfil/${auth.currentUser.uid}`);
                const snapshot = await uploadBytes(storageRef, compressedBlob);
                const downloadURL = await getDownloadURL(snapshot.ref);

                // Atualize a foto de perfil do usuário no banco de dados Firebase
                await updateDoc(doc(db, "users", auth.currentUser.uid), {
                    photoURL: downloadURL
                });

                // Atualize a foto de perfil na interface do usuário
                document.getElementById("userProfilePicture").src = downloadURL;
            } catch (error) {
                console.error("Erro ao fazer upload da foto de perfil:", error);
            }
        }

        document.getElementById('btnEscolherFotoPerfil').addEventListener('click', function () {
            document.getElementById('inputFotoPerfil').click();
        })

        window.handleProfilePictureUpload = function (event) {
            const file = event.target.files[0];
            if (file) {
                compressAndUploadProfilePicture(file);
            }
        }

        // Função para exibir o perfil do usuário
        async function exibirPerfilUsuario(uid) {
            try {
                // Obter os dados do usuário do Firestore
                const userDoc = await getDoc(doc(db, "users", uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();

                    // Atualizar o nome do usuário
                    const userProfileName = document.getElementById("userProfileName");
                    userProfileName.textContent = userData.fullName || "Nome do usuário não disponível";

                    // Verificar se o usuário possui uma foto de perfil
                    if (userData.photoURL) {
                        // Se tiver, atualizar a foto de perfil do usuário
                        const userProfilePicture = document.getElementById("userProfilePicture");
                        const userProfilePicturePopUp = document.getElementById("userProfilePicturePopUp");
                        userProfilePicturePopUp.src = userData.photoURL;
                        userProfilePicture.src = userData.photoURL;
                    } else {
                        // Se não tiver, usar uma foto de perfil padrão
                        const userProfilePicture = document.getElementById("userProfilePicture");
                        const userProfilePicturePopUp = document.getElementById("userProfilePicturePopUp");
                        userProfilePicture.src = "perfil/fotoPadrao.png";
                        userProfilePicturePopUp.src = "perfil/fotoPadrao.png";
                    }
                } else {
                    console.log("Usuário não encontrado no Firestore");
                }
            } catch (error) {
                console.error("Erro ao exibir perfil do usuário:", error);
            }
        }

        // Função para verificar se o usuário já curtiu uma publicação
        function hasLikedPost(postId) {
            return localStorage.getItem(`like_${postId}`) === 'true';
        }

        // Função para verificar se o usuário já descurtiu uma publicação
        function hasDislikedPost(postId) {
            return localStorage.getItem(`dislike_${postId}`) === 'true';
        }

        // Função para incrementar um valor em um campo específico
        window.increment = function (value) {
            return value + 1;
        }

        // Função para curtir uma publicação
        window.likePost = async function (postId) {
            try {
                if (hasLikedPost(postId)) {
                    console.log("Você já curtiu esta publicação.");
                    return;
                }

                if (hasDislikedPost(postId)) {
                    await removeDislike(postId);
                }

                const postRef = doc(db, "publicacoes", postId);
                await incrementCounter(postRef, 'likes');
                const likeCountElement = document.getElementById(`likeCount_${postId}`);
                likeCountElement.textContent = parseInt(likeCountElement.textContent) + 1;

                const likeButton = document.getElementById(`likeButton_${postId}`);
                likeButton.disabled = true;

                localStorage.setItem(`like_${postId}`, 'true');

                // Adicionar interação
                const user = auth.currentUser;
                if (user) {
                    await addInteraction(user.uid, "like", postId, user.displayName, user.photoURL);
                }

                // Adicionar notificação
                const postSnapshot = await getDoc(postRef);
                if (postSnapshot.exists()) {
                    const postData = postSnapshot.data();
                    await addNotification(postData.userId, `curtiu sua publicação`, postId);
                }
            } catch (error) {
                console.error("Erro ao curtir a publicação:", error);
            }
        }

        // Função para descurtir uma publicação
        window.dislikePost = async function (postId) {
            try {
                if (hasDislikedPost(postId)) {
                    console.log("Você já descurtiu esta publicação.");
                    return;
                }

                if (hasLikedPost(postId)) {
                    await removeDislike(postId);
                }

                const postRef = doc(db, "publicacoes", postId);
                await incrementCounter(postRef, 'dislikes');
                const dislikeCountElement = document.getElementById(`dislikeCount_${postId}`);
                dislikeCountElement.textContent = parseInt(dislikeCountElement.textContent) + 1;

                const dislikeButton = document.getElementById(`dislikeButton_${postId}`);
                dislikeButton.disabled = true;

                localStorage.setItem(`dislike_${postId}`, 'true');

                // Adicionar interação
                const user = auth.currentUser;
                if (user) {
                    await addInteraction(user.uid, "dislike", postId, user.displayName, user.photoURL);
                }

                // Adicionar notificação
                const postSnapshot = await getDoc(postRef);
                if (postSnapshot.exists()) {
                    const postData = postSnapshot.data();
                    await addNotification(postData.userId, `descurtiu sua publicação`, postId);
                }
            } catch (error) {
                console.error("Erro ao descurtir a publicação:", error);
            }
        }

        window.incrementCounter = async function (docRef, field) {
            try {
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const currentData = docSnap.data();
                    const newValue = currentData[field] ? currentData[field] + 1 : 1; // Incrementar o valor atual ou começar de 1 se não existir
                    await updateDoc(docRef, {
                        [field]: newValue
                    });
                } else {
                    // Se o documento não existir, criar um novo com o campo inicializado com 1
                    await setDoc(docRef, { [field]: 1 });
                }
            } catch (error) {
                console.error("Erro ao incrementar o contador:", error);
            }
        }

        // Função para remover a marcação de descurtida de uma publicação
        window.removeDislike = async function (postId) {
            try {
                // Remover a marcação de descurtida da publicação do armazenamento local
                localStorage.removeItem(`dislike_${postId}`);

                // Atualizar o contador de descurtidas na interface do usuário
                const dislikeCountElement = document.getElementById(`dislikeCount_${postId}`);
                dislikeCountElement.textContent = parseInt(dislikeCountElement.textContent) - 1;

                // Habilitar o botão de descurtir após remover a descurtida
                const dislikeButton = document.getElementById(`dislikeButton_${postId}`);
                dislikeButton.disabled = false;

                console.log("Descurtida removida com sucesso.");
            } catch (error) {
                console.error("Erro ao remover a descurtida:", error);
            }
        }

        // Função para adicionar um comentário a uma publicação
        window.addComment = async function (postId) {
            try {
                const commentText = document.getElementById(`commentText_${postId}`).value;

                if (!commentText) {
                    alert("Por favor, digite seu comentário.");
                    return;
                }

                const comentarioRef = await addDoc(collection(db, `publicacoes/${postId}/comentarios`), {
                    texto: commentText,
                    userId: auth.currentUser.uid,
                    timestamp: serverTimestamp()
                });

                document.getElementById(`commentText_${postId}`).value = "";

                showComments(postId);

                // Adicionar interação
                const user = auth.currentUser;
                if (user) {
                    await addInteraction(user.uid, "comment", postId, user.displayName, user.photoURL);
                }

                // Adicionar notificação
                const postRef = doc(db, "publicacoes", postId);
                const postSnapshot = await getDoc(postRef);
                if (postSnapshot.exists()) {
                    const postData = postSnapshot.data();
                    await addNotification(postData.userId, `comentou em sua publicação`, postId);
                }
            } catch (error) {
                console.error("Erro ao adicionar comentário:", error);
            }
        }

        let commentsVisible = false;

        // Função para exibir ou ocultar os comentários de uma publicação
        window.showComments = async function (postId) {
            try {
                const commentsDiv = document.getElementById(`comments_${postId}`);
                // Verificar se os comentários já estão visíveis
                const isVisible = commentsDiv.style.display === "block";

                // Se os comentários estiverem visíveis, oculte-os; caso contrário, exiba-os
                if (isVisible) {
                    commentsDiv.style.display = "none";
                } else {
                    // Limpar os comentários antes de exibir os novos
                    commentsDiv.innerHTML = "";

                    const comentariosRef = collection(db, `publicacoes/${postId}/comentarios`);
                    const querySnapshot = await getDocs(comentariosRef);

                    // Verificar se há comentários antes de exibir
                    if (querySnapshot.empty) {
                        return; // Se não houver comentários, saia da função
                    }

                    querySnapshot.forEach(async (doc) => {
                        const comentario = doc.data();
                        const user = await getUserData(comentario.userId);

                        // Criar um contêiner para o comentário
                        const commentContainer = document.createElement("div");
                        commentContainer.style.backgroundColor = "#DFDEDE";
                        commentContainer.style.padding = "10px";
                        commentContainer.style.borderRadius = "4px";
                        commentContainer.style.marginTop = "10px";
                        commentContainer.style.marginBottom = "3%";
                        commentContainer.style.display = "flex"; // Exibir em linha
                        commentContainer.style.alignItems = "center"; // Alinhar itens ao centro

                        // Adicionar a foto do usuário ao contêiner
                        const userImg = document.createElement("img");
                        userImg.src = user.photoURL;
                        userImg.alt = "Foto do usuário";
                        userImg.style.width = "11%";
                        userImg.style.height = "10%";
                        userImg.style.marginTop = "-15%";
                        userImg.style.borderRadius = "50%";
                        commentContainer.appendChild(userImg);

                        // Criar um contêiner para o nome de usuário e o texto do comentário
                        const userInfoContainer = document.createElement("div");
                        userInfoContainer.style.marginLeft = "10px"; // Adicionar margem à esquerda
                        commentContainer.appendChild(userInfoContainer);

                        // Adicionar o nome do usuário ao contêiner
                        const userName = document.createElement("p");
                        userName.textContent = user.fullName;
                        userInfoContainer.appendChild(userName);

                        // Adicionar o texto do comentário ao contêiner
                        const commentText = document.createElement("p");
                        commentText.textContent = comentario.texto;
                        userInfoContainer.appendChild(commentText);

                        // Adicionar a data e hora do comentário
                        const timestamp = comentario.timestamp.toDate();
                        const dataFormatada = `${timestamp.getDate()}/${timestamp.getMonth() + 1}/${timestamp.getFullYear()} ${timestamp.getHours()}:${timestamp.getMinutes()}`;
                        const commentTime = document.createElement("p");
                        commentTime.textContent = `Data e Hora: ${dataFormatada}`;
                        userInfoContainer.appendChild(commentTime);

                        // Adicionar o contêiner de comentário à lista de comentários
                        commentsDiv.appendChild(commentContainer);
                    });

                    // Exibir os comentários
                    commentsDiv.style.display = "block";
                }
            } catch (error) {
                console.error("Erro ao exibir ou ocultar comentários:", error);
            }
        }

        // Função para obter informações do usuário com base no userId
        async function getUserData(userId) {
            const userDoc = await getDoc(doc(db, "users", userId));
            if (userDoc.exists()) {
                return userDoc.data();
            } else {
                return null;
            }
        }

        // Função para excluir uma publicação
        window.deletePost = async function (postId, userId) {
            try {
                // Confirmar se o usuário deseja realmente excluir a publicação
                const confirmDelete = confirm("Tem certeza de que deseja excluir esta publicação?");
                if (!confirmDelete) {
                    return;
                }

                // Verificar se o usuário atual é o dono da publicação
                if (userId !== auth.currentUser.uid) {
                    console.log("Você não tem permissão para excluir esta publicação.");
                    return;
                }

                // Excluir todos os comentários associados à publicação
                const comentariosRef = collection(db, `publicacoes/${postId}/comentarios`);
                const comentariosSnapshot = await getDocs(comentariosRef);
                comentariosSnapshot.forEach(async (doc) => {
                    await deleteDoc(doc.ref);
                });

                // Excluir a imagem associada à publicação no Storage
                const postDoc = await getDoc(doc(db, "publicacoes", postId));
                if (postDoc.exists()) {
                    const postData = postDoc.data();
                    if (postData.imagemUrl) {
                        const imageRef = ref(storage, postData.imagemUrl);
                        await deleteObject(imageRef);
                        console.log("Imagem associada à publicação excluída com sucesso.");
                    }
                }

                // Finalmente, excluir o documento de publicação
                await deleteDoc(doc(db, "publicacoes", postId));

                console.log("Publicação excluída com sucesso.");
            } catch (error) {
                console.error("Erro ao excluir a publicação:", error);
            }

            location.reload();
        }

        // Função para atualizar os contadores de likes e deslikes
        window.updateLikeDislikeCounts = async function (postId) {
            const postRef = doc(db, "publicacoes", postId);
            const postSnap = await getDoc(postRef);
            if (postSnap.exists()) {
                const postData = postSnap.data();
                let likeCount = +1;
                let dislikeCount = +1;
                if (postData.likes) {
                    likeCount = postData.likes;
                }
                if (postData.dislikes) {
                    dislikeCount = postData.dislikes;
                }
                const likeCountElement = document.getElementById(`likeCount_${postId}`);
                const dislikeCountElement = document.getElementById(`dislikeCount_${postId}`);
                likeCountElement.textContent = likeCount;
                dislikeCountElement.textContent = dislikeCount;
            }
        }

        window.signOut = function () {
            try {
                // Fazer logout do usuário usando Firebase Authentication
                auth.signOut().then(() => {
                    // Redirecionar o usuário para a página de login após fazer logout
                    window.location.href = "login.html";
                }).catch((error) => {
                    console.error("Erro ao fazer logout:", error);
                });
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
            }
        }

        // Adicione ouvintes de eventos para detectar mudanças no input de mensagem
        document.getElementById('inputMensagem').addEventListener('input', function () {
            // Atualize a mensagem na pré-visualização
            const mensagem = this.value;
            document.getElementById('mensagemPreview').textContent = mensagem;
        });

        // Adicione ouvintes de eventos para detectar mudanças no input de descrição
        document.getElementById('inputDescricao').addEventListener('input', function () {
            // Atualize a descrição na pré-visualização
            const descricao = this.value;
            document.getElementById('descricaoPreview').textContent = descricao;
        });

        // Adicione ouvintes de eventos para detectar mudanças no input de preço
        document.getElementById('inputPreco').addEventListener('input', function () {
            // Atualize o preço na pré-visualização
            const preco = this.value;
            document.getElementById('precoPreview').textContent = `Preço: R$ ${preco}`;
        });

        // Adicione um ouvinte de eventos para detectar mudanças no input de arquivo
        document.getElementById('inputImagem').addEventListener('change', function () {
            // Verifique se algum arquivo foi selecionado
            if (this.files && this.files[0]) {
                const reader = new FileReader();

                // Quando o arquivo terminar de carregar, atualize a pré-visualização da imagem
                reader.onload = function (e) {
                    document.getElementById('imgPreview').src = e.target.result;
                }

                // Leia o conteúdo do arquivo como uma URL de dados
                reader.readAsDataURL(this.files[0]);

                // Exiba o container de pré-visualização
                document.getElementById('previewContainer').style.display = 'block';
            } else {
                // Se nenhum arquivo for selecionado, oculte o container de pré-visualização
                document.getElementById('previewContainer').style.display = 'none';
            }
        });

        // Função para denunciar uma publicação
        window.reportPost = async function (postId) {
            try {
                const docRef = doc(db, "publicacoes", postId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data && data.mensagem) {
                        const motivo = prompt("Por favor, informe o motivo da denúncia:");
                        if (motivo) {
                            const reportData = {
                                postId: postId,
                                motivo: motivo,
                                dataDenuncia: new Date().toISOString(),
                                conteudoPublicacao: {
                                    mensagem: data.mensagem,
                                    imagemUrl: data.imagemUrl || null
                                }
                            };
                            await addDoc(collection(db, "reportes"), reportData);
                            alert("Publicação denunciada com sucesso. Nossa equipe avaliará sua denúncia.");
                        } else {
                            alert("O motivo da denúncia é obrigatório.");
                        }
                    } else {
                        alert("A publicação não possui uma mensagem.");
                    }
                } else {
                    alert("A publicação não existe.");
                }
            } catch (error) {
                console.error("Erro ao denunciar a publicação:", error);
                alert("Ocorreu um erro ao denunciar a publicação. Por favor, tente novamente mais tarde.");
            }
        }

        // Função para exibir o perfil do usuário ao clicar no nome ou na foto de perfil
        function showUserProfile(userId) {
            console.log("Mostrando perfil do usuário com ID:", userId);

            // Obter o elemento do perfil do usuário
            const userProfileContainer = document.getElementById("userProfileContainer");
            const userProfileName = document.getElementById("userProfileName");
            const userProfilePicturePopUp = document.getElementById("userProfilePicturePopUp");

            // Limpar as informações anteriores do perfil do usuário
            userProfileName.textContent = "";
            userProfilePicturePopUp.src = "";

            // Exibir o perfil do usuário
            exibirPerfilUsuario(userId);

            // Mostrar a tela de perfil do usuário
            userProfileContainer.style.display = "flex";
        }

        // Função para fechar a tela do perfil do usuário
        window.closeUserProfile = function () {
            console.log("Fechando perfil do usuário.");

            // Ocultar a tela de perfil do usuário
            const userProfileContainer = document.getElementById("userProfileContainer");
            userProfileContainer.style.display = "none";
        }

        window.addNotification = async function (userId, message, postId) {
            try {
                // Obter informações do usuário que interagiu
                const userDoc = await getDoc(doc(db, "users", userId));
                const userData = userDoc.data();

                // Verificar se encontrou os dados do usuário
                if (userData) {
                    // Salvar a notificação com nome e foto do usuário
                    await addDoc(collection(db, "notificacoes"), {
                        userId: userId,
                        message: message,
                        postId: postId,
                        fullName: userData.fullName,
                        photoURL: userData.photoURL,
                        timestamp: serverTimestamp(),
                        read: false
                    });
                } else {
                    throw new Error("Dados do usuário não encontrados.");
                }
            } catch (error) {
                console.error("Erro ao adicionar notificação:", error);
            }
        }

        window.getUserNotifications = async function (userId) {
            try {
                const notificationsRef = collection(db, "notificacoes");
                const q = query(notificationsRef, where("userId", "==", userId), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);

                const notificationsList = document.getElementById("notificationsList");
                notificationsList.innerHTML = "";

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const notificationItem = document.createElement("li");
                    notificationItem.classList.add("notification-item");

                    // Criar elementos para mostrar as informações da notificação
                    const userPhoto = document.createElement("img");
                    userPhoto.src = data.photoURL; // Usar photoURL da notificação
                    userPhoto.alt = "Foto de perfil do usuário";

                    const userName = document.createElement("span");
                    userName.textContent = data.fullName; // Usar fullName da notificação

                    const notificationText = document.createElement("span");
                    notificationText.textContent = `${data.message} em ${data.timestamp.toDate().toLocaleString()}`;

                    // Adicionar elementos à lista de notificações
                    notificationItem.appendChild(userPhoto);
                    notificationItem.appendChild(userName);
                    notificationItem.appendChild(notificationText);

                    notificationsList.appendChild(notificationItem);
                });
            } catch (error) {
                console.error("Erro ao obter notificações:", error);
            }
        }

        // Função para adicionar uma interação
        window.addInteraction = async function (userId, actionType, postId, fullName, photoURL) {
            try {
                await addDoc(collection(db, "interactions"), {
                    userId: userId,
                    actionType: actionType, // ex: "like", "dislike", "comment"
                    postId: postId,
                    fullName: fullName,
                    photoURL: photoURL,
                    timestamp: serverTimestamp()
                });
            } catch (error) {
                console.error("Erro ao adicionar interação:", error);
            }
        }

    </script>
</body>

</html>
